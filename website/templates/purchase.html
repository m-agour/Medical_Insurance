{% extends "base.html" %}
{% block title %}Purchase Plan{% endblock %}
{% block content %}

<script>
   function changePlans (code) {
       let cont_id = parseInt(code.value);
       let plan_id = 0;
       let text = '';
       let contracts = {{ contracts | tojson }};
       let plans = {{ plans | tojson }};
       for(let i in contracts){
           if (parseInt(contracts[i][0]) === cont_id){
               plan_id = contracts[i][1];
               break;
           }
       }
       for(let i in plans){
           if(parseInt(plans[i][0]) === plan_id) continue;
           text += '<option value="' + plans[i][0] + '" style="font-weight: bold;">' + plans[i][1] + '</option>';

       }
       document.getElementById('plans').innerHTML = text ;
       change_detail();
    }
    $( document ).ready(function() {
        change_detail();
    });

   function change_detail() {
            let plans = {{ plans | tojson }};
            let p_idx = parseInt(document.getElementById('plans').value);
            for(let i in plans){

                if(p_idx === parseInt(plans[i][0])){
                    p_idx = i;
                    break
                }
            }
            document.getElementById("curr_plan").innerText = "price: "+  plans[p_idx][3] +" EGP  -  Benefits: " +  plans[p_idx][2];
    }

</script>


    <div>
    <div>
        <div class="d-lg-flex justify-content-lg-center"></div>
    </div>
    <div class="d-lg-flex justify-content-center justify-content-lg-center" style="margin-right: 100px;margin-left: 100px;margin-top: 24px;margin-bottom: 50px;">
        <div class="container shadow" style="background: rgba(70,211,126,0.18);padding: 29px;border-radius: 14px;">
            <div class="row" style="margin-top: -17px;padding-top: 51px;padding-bottom: 56px;border-top-color: var(--bs-cyan);">
                <div class="col">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <form id="form1" method="post">
<h6 class="text-center" style="background: var(--bs-yellow);padding: 9px 9px 13px;margin-bottom: 18px;color: var(--bs-indigo);font-size: 18px;">Purchase new plan</h6>
                                <div class="row">
                                    <div class="col">
                                        <div class="row">
                                            <div class="col">
                                                <div>
                                                    <div style="padding-bottom: 20px;padding-top: 47px;">
                                                        <div class="row" style="margin-left: -80px;">
                                                            <div class="col text-end" style="margin-right: 0;padding-bottom: 0;"><label class="col-form-label" style="font-weight: bold;">Beneficiary</label></div>
                                                            <div class="col"><select name="ben" class="form-select form-select-sm" style="font-size: 17px;color: #15674f;font-weight: bold;width: 271.2px;" name="plan" onchange="changePlans(this);" required>
                                                                {% for con in contracts %}
                                                                    {% if con.cus_id %}
                                                                    <option value="{{ con.id }}" style="color: #15674f;font-weight: bold;">You - {{  plans_dict[con.plan_id] }}</option>
                                                                    {% else %}
                                                                    <option value="{{ con.id }}" style="color: #15674f;font-weight: bold;">{{ con.kinship.capitalize() }}, {{  con.dep_name.capitalize() }} - {{  plans_dict[con.plan_id] }}</option>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </select></div>
                                                        </div>
                                                    </div>
                                                    <div style="padding-bottom: 20px;">
                                                        <div class="row" style="margin-left: -80px;">
                                                            <div class="col" style="margin-right: 0;text-align: right;width: 528.1px;"><label class="col-form-label" style="font-weight: bold;">Plan</label></div>
                                                            <div class="col"><select id="plans" name="plans" onchange="change_detail();" name="plan" class="form-select form-select-sm" style="font-size: 17px;color: #15674f;font-weight: bold;width: 138.2px;" name="plan" required>
                                                                {% for i in plans %}
                                                                    {% if i.id != contracts[0].plan_id %}
                                                                        <option value="{{ i.id }}" style="font-weight: bold;">{{ i.type }}</option>
                                                                    {% endif %}
                                                                {% endfor %}
                                                                </select></div>
                                                        </div>
                                                    <br><br>
                                                    </div><button class="btn btn-primary" type="submit" form='form1' style="margin-left: 23px;">Purchase</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <br>
                                <div style="margin-top: 0;">
                                    <div><h4 id='curr_plan' class="col-form-label"></h4></div>
                                </div>
                                <div style="margin-top: 23px;"><label class="form-label">Note: If the beneficiary already hasÂ  a plan, purchasing a new one will override the old one.</label><label class="form-label">Your payment method will be charged directly according to the plan&#39;s prices listed below.</label>
                                    <div></div>
                                </div>
                            </form><label class="form-label"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <script>
        change_detail();
    </script>
{% endblock %}